//>>built
define("dojox/charting/plot2d/Pie","dojo/_base/lang,dojo/_base/array,dojo/_base/declare,./Base,./_PlotEvents,./common,dojox/gfx,dojox/gfx/matrix,dojox/lang/functional,dojox/lang/utils".split(","),function(A,n,B,E,I,J,s,H,i,C){return B("dojox.charting.plot2d.Pie",[E,I],{defaultParams:{labels:!0,ticks:!1,fixed:!0,precision:1,labelOffset:20,labelStyle:"default",htmlLabels:!0,radGrad:"native",fanSize:5,startAngle:0},optionalParams:{radius:0,omitLabels:!1,stroke:{},outline:{},shadow:{},fill:{},styleFunc:null,
font:"",fontColor:"",labelWiring:{}},constructor:function(h,b){this.opt=A.clone(this.defaultParams);C.updateWithObject(this.opt,b);C.updateWithPattern(this.opt,b,this.optionalParams);this.axes=[];this.run=null;this.dyn=[]},clear:function(){this.inherited(arguments);this.dyn=[];this.run=null;return this},setAxis:function(){return this},addSeries:function(h){this.run=h;return this},getSeriesStats:function(){return A.delegate(J.defaultStats)},getRequiredColors:function(){return this.run?this.run.data.length:
0},render:function(h,b){if(!this.dirty)return this;this.resetEvents();this.dirty=!1;this._eventSeries={};this.cleanGroup();var l=this.group,c=this.chart.theme;if(!this.run||!this.run.data.length)return this;var d=(h.width-b.l-b.r)/2,e=(h.height-b.t-b.b)/2,g=Math.min(d,e),u="font"in this.opt?this.opt.font:c.series.font,m,y=H._degToRad(this.opt.startAngle),k=y,j,q,r,z,v=this.run.data,C=this.events();this.dyn=[];if("radius"in this.opt)g=this.opt.radius,z=g-this.opt.labelOffset;var a={cx:b.l+d,cy:b.t+
e,r:g};if(this.opt.shadow||c.shadow){j=this.opt.shadow||c.shadow;var w=A.clone(a);w.cx+=j.dx;w.cy+=j.dy;l.createCircle(w).setFill(j.color).setStroke(j)}if("number"==typeof v[0]){j=i.map(v,"x ? Math.max(x, 0) : 0");if(i.every(j,"<= 0"))return l.createCircle(a).setStroke(c.series.stroke),this.dyn=n.map(j,function(){return{}}),this;q=i.map(j,"/this",i.foldl(j,"+",0));this.opt.labels&&(r=n.map(q,function(a){return 0<a?this._getLabel(100*a)+"%":""},this))}else{j=i.map(v,"x ? Math.max(x.y, 0) : 0");if(i.every(j,
"<= 0"))return l.createCircle(a).setStroke(c.series.stroke),this.dyn=n.map(j,function(){return{}}),this;q=i.map(j,"/this",i.foldl(j,"+",0));this.opt.labels&&(r=n.map(q,function(a,b){if(0>a)return"";var c=v[b];return"text"in c?c.text:this._getLabel(100*a)+"%"},this))}var D=i.map(v,function(a){var b=[this.opt,this.run];null!==a&&"number"!=typeof a&&b.push(a);this.opt.styleFunc&&b.push(this.opt.styleFunc(a));return c.next("slice",b,!0)},this);this.opt.labels&&(m=u?s.normalizedLength(s.splitFontString(u).size):
0,j=i.foldl1(i.map(r,function(a,b){return s._base._getTextBox(a,{font:D[b].series.font}).w},this),"Math.max(a, b)")/2,0>this.opt.labelOffset&&(g=Math.min(d-2*j,e-m)+this.opt.labelOffset),z=g-this.opt.labelOffset);var F=Array(q.length);n.some(q,function(c,d){if(0>c)return!1;if(0==c)return this.dyn.push({fill:null,stroke:null}),!1;var o=v[d],t=D[d],f;if(1<=c){f=this._plotFill(t.series.fill,h,b);f=this._shapeFill(f,{x:a.cx-a.r,y:a.cy-a.r,width:2*a.r,height:2*a.r});f=this._pseudoRadialFill(f,{x:a.cx,
y:a.cy},a.r);var e=l.createCircle(a).setFill(f).setStroke(t.series.stroke);this.dyn.push({fill:f,stroke:t.series.stroke});C&&(o={element:"slice",index:d,run:this.run,shape:e,x:d,y:"number"==typeof o?o:o.y,cx:a.cx,cy:a.cy,cr:g},this._connectEvents(o),F[d]=o);return!1}var j=k+2*c*Math.PI;d+1==q.length&&(j=y+2*Math.PI);var e=j-k,i=a.cx+g*Math.cos(k),u=a.cy+g*Math.sin(k),m=a.cx+g*Math.cos(j),n=a.cy+g*Math.sin(j);f=H._degToRad(this.opt.fanSize);if(t.series.fill&&"radial"===t.series.fill.type&&"fan"===
this.opt.radGrad&&e>f){var r=l.createGroup(),s=Math.ceil(e/f),x=e/s;f=this._shapeFill(t.series.fill,{x:a.cx-a.r,y:a.cy-a.r,width:2*a.r,height:2*a.r});for(var p=0;p<s;++p){var w=0==p?i:a.cx+g*Math.cos(k+(p-0.2)*x),z=0==p?u:a.cy+g*Math.sin(k+(p-0.2)*x),A=p==s-1?m:a.cx+g*Math.cos(k+(p+1+0.2)*x),B=p==s-1?n:a.cy+g*Math.sin(k+(p+1+0.2)*x);r.createPath().moveTo(a.cx,a.cy).lineTo(w,z).arcTo(g,g,0,x>Math.PI,!0,A,B).lineTo(a.cx,a.cy).closePath().setFill(this._pseudoRadialFill(f,{x:a.cx,y:a.cy},g,k+(p+0.5)*
x,k+(p+0.5)*x))}r.createPath().moveTo(a.cx,a.cy).lineTo(i,u).arcTo(g,g,0,e>Math.PI,!0,m,n).lineTo(a.cx,a.cy).closePath().setStroke(t.series.stroke);e=r}else e=l.createPath().moveTo(a.cx,a.cy).lineTo(i,u).arcTo(g,g,0,e>Math.PI,!0,m,n).lineTo(a.cx,a.cy).closePath().setStroke(t.series.stroke),(f=t.series.fill)&&"radial"===f.type?(f=this._shapeFill(f,{x:a.cx-a.r,y:a.cy-a.r,width:2*a.r,height:2*a.r}),"linear"===this.opt.radGrad&&(f=this._pseudoRadialFill(f,{x:a.cx,y:a.cy},g,k,j))):f&&"linear"===f.type&&
(f=this._plotFill(f,h,b),f=this._shapeFill(f,e.getBoundingBox())),e.setFill(f);this.dyn.push({fill:f,stroke:t.series.stroke});C&&(o={element:"slice",index:d,run:this.run,shape:e,x:d,y:"number"==typeof o?o:o.y,cx:a.cx,cy:a.cy,cr:g},this._connectEvents(o),F[d]=o);k=j;return!1},this);if(this.opt.labels)if("default"==this.opt.labelStyle)k=y,n.some(q,function(b,c){if(0>=b)return!1;var d=D[c];if(1<=b)return this.renderLabel(l,a.cx,a.cy+m/2,r[c],d,0<this.opt.labelOffset),!0;var e=k+2*b*Math.PI;c+1==q.length&&
(e=y+2*Math.PI);if(this.opt.omitLabels&&0.001>e-k)return!1;var f=(k+e)/2,g=a.cx+z*Math.cos(f),f=a.cy+z*Math.sin(f)+m/2;this.renderLabel(l,g,f,r[c],d,0<this.opt.labelOffset);k=e;return!1},this);else if("columns"==this.opt.labelStyle){var k=y,B=this.opt.omitLabels,G=[];n.forEach(q,function(a,b){var c=k+2*a*Math.PI;b+1==q.length&&(c=y+2*Math.PI);var d=(k+c)/2;G.push({angle:d,left:0>Math.cos(d),theme:D[b],index:b,omit:B?0.001>c-k:!1});k=c});d=s._base._getTextBox("a",{font:u}).h;this._getProperLabelRadius(G,
d,1.1*a.r);n.forEach(G,function(b,c){if(!b.omit){var d=a.cx-2*a.r,e=a.cx+2*a.r,f=s._base._getTextBox(r[c],{font:b.theme.series.font}).w,g=a.cx+b.labelR*Math.cos(b.angle),h=a.cy+b.labelR*Math.sin(b.angle),e=b.left?d+f:e-f,d=b.left?d:e,j=l.createPath().moveTo(a.cx+a.r*Math.cos(b.angle),a.cy+a.r*Math.sin(b.angle));Math.abs(b.labelR*Math.cos(b.angle))<2*a.r-f&&j.lineTo(g,h);j.lineTo(e,h).setStroke(b.theme.series.labelWiring);this.renderLabel(l,d,h,r[c],b.theme,!1,"left")}},this)}var E=0;this._eventSeries[this.run.name]=
i.map(v,function(a){return 0>=a?null:F[E++]});return this},_getProperLabelRadius:function(h,b,l){var c,d,e=1,g=1;if(1==h.length)h[0].labelR=l;else{for(var i=0;i<h.length;i++){var m=Math.abs(Math.sin(h[i].angle));h[i].left?e>=m&&(e=m,c=h[i]):g>=m&&(g=m,d=h[i])}c.labelR=d.labelR=l;this._calculateLabelR(c,h,b);this._calculateLabelR(d,h,b)}},_calculateLabelR:function(h,b,i){for(var c=h.index,d=b.length,e=h.labelR;!(b[c%d].left^b[(c+1)%d].left);){if(!b[(c+1)%d].omit)e=(Math.sin(b[c%d].angle)*e+(b[c%d].left?
-i:i))/Math.sin(b[(c+1)%d].angle),e=e<h.labelR?h.labelR:e,b[(c+1)%d].labelR=e;c++}c=h.index;for(d=0==c?d-1:c-1;!(b[c].left^b[d].left);){if(!b[d].omit)e=(Math.sin(b[c].angle)*e+(b[c].left?i:-i))/Math.sin(b[d].angle),e=e<h.labelR?h.labelR:e,b[d].labelR=e;c--;d--;c=0>c?c+b.length:c;d=0>d?d+b.length:d}}})});